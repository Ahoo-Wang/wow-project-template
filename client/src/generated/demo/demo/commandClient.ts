import { ContentTypeValues } from "@ahoo-wang/fetcher";
import { type ApiMetadata, type ApiMetadataCapable, api, attribute, autoGeneratedError, del, path, post, put, request } from "@ahoo-wang/fetcher-decorator";
import { JsonEventStreamResultExtractor } from "@ahoo-wang/fetcher-eventstream";
import type { CommandRequest, CommandResult, CommandResultEventStream, DeleteAggregate, RecoverAggregate } from "@ahoo-wang/fetcher-wow";
import { CreateDemo, UpdateDemo } from "./types";

export enum DemoCommandEndpointPaths {
    CREATE_DEMO = '/tenant/{tenantId}/demo',
    DEFAULT_DELETE_AGGREGATE = '/tenant/{tenantId}/demo/{id}',
    DEFAULT_RECOVER_AGGREGATE = '/tenant/{tenantId}/demo/{id}/recover',
    UPDATE_DEMO = '/tenant/{tenantId}/demo/{id}'
}

const DEFAULT_COMMAND_CLIENT_OPTIONS: ApiMetadata = {
    basePath: 'demo'
};

@api()
export class DemoCommandClient<R = CommandResult> implements ApiMetadataCapable {
    constructor(public readonly apiMetadata: ApiMetadata = DEFAULT_COMMAND_CLIENT_OPTIONS) {
    }

    /**
     * 创建Demo
     * - operationId: `demo.demo.create_demo`
     * - path: `/tenant/{tenantId}/demo`
     */
    @post(DemoCommandEndpointPaths.CREATE_DEMO)
    createDemo(@request() commandRequest: CommandRequest<CreateDemo>, @attribute() attributes?: Record<string, any>): Promise<R> {
        throw autoGeneratedError(commandRequest, attributes);
    }

    /**
     * Delete aggregate
     * - operationId: `demo.demo.default_delete_aggregate`
     * - path: `/tenant/{tenantId}/demo/{id}`
     */
    @del(DemoCommandEndpointPaths.DEFAULT_DELETE_AGGREGATE)
    defaultDeleteAggregate(@path('id') id: string, @request() commandRequest?: CommandRequest<DeleteAggregate>, @attribute() attributes?: Record<string, any>): Promise<R> {
        throw autoGeneratedError(id, commandRequest, attributes);
    }

    /**
     * Recover deleted aggregate
     * - operationId: `demo.demo.default_recover_aggregate`
     * - path: `/tenant/{tenantId}/demo/{id}/recover`
     */
    @put(DemoCommandEndpointPaths.DEFAULT_RECOVER_AGGREGATE)
    defaultRecoverAggregate(@path('id') id: string, @request() commandRequest?: CommandRequest<RecoverAggregate>, @attribute() attributes?: Record<string, any>): Promise<R> {
        throw autoGeneratedError(id, commandRequest, attributes);
    }

    /**
     * 更新Demo
     * - operationId: `demo.demo.update_demo`
     * - path: `/tenant/{tenantId}/demo/{id}`
     */
    @put(DemoCommandEndpointPaths.UPDATE_DEMO)
    updateDemo(@path('id') id: string, @request() commandRequest: CommandRequest<UpdateDemo>, @attribute() attributes?: Record<string, any>): Promise<R> {
        throw autoGeneratedError(id, commandRequest, attributes);
    }
}

@api('', {
    headers: { Accept: ContentTypeValues.TEXT_EVENT_STREAM },
    resultExtractor: JsonEventStreamResultExtractor,
})
export class DemoStreamCommandClient extends DemoCommandClient<CommandResultEventStream> {
    constructor(apiMetadata: ApiMetadata = DEFAULT_COMMAND_CLIENT_OPTIONS) {
        super(apiMetadata);
    }
}
